<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than draw.io -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" style="background: #ffffff; background-color: light-dark(#ffffff, var(--ge-dark-color, #121212)); color-scheme: light dark;" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1382px" height="3471px" viewBox="0 0 1382 3471" content="&lt;mxfile host=&quot;app.diagrams.net&quot; agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36&quot; version=&quot;28.2.8&quot; scale=&quot;1&quot; border=&quot;0&quot;&gt;&#10;  &lt;diagram name=&quot;Page-1&quot; id=&quot;fnxfZMOx_S3J6NDtlel6&quot;&gt;&#10;    &lt;mxGraphModel dx=&quot;5850&quot; dy=&quot;2970&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;850&quot; pageHeight=&quot;1100&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&#10;      &lt;root&gt;&#10;        &lt;mxCell id=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;1&quot; parent=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-21&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; parent=&quot;1&quot; source=&quot;NsGaYPzq55yLYkSI8ves-1&quot; target=&quot;NsGaYPzq55yLYkSI8ves-5&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-1&quot; value=&quot;ALICE&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-5&quot; y=&quot;40&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-25&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; parent=&quot;1&quot; source=&quot;NsGaYPzq55yLYkSI8ves-2&quot; target=&quot;NsGaYPzq55yLYkSI8ves-4&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-2&quot; value=&quot;BOB&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;657.18&quot; y=&quot;40&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-3&quot; value=&quot;SERVER&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;345&quot; y=&quot;40&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-4&quot; value=&quot;PQKEM.KeyGen()&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;identity key(IK_pub_B,&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;IK_prv_B&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;)&amp;lt;/span&amp;gt;&amp;lt;div&amp;gt;signed prekey(SPK_pub_B,SPK_prv_B)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Post-Quantum_Prekey(PQK_pub_B,PQK_prv_B)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;One-Time Prekey (OPK_B)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Sig(IK_pub_B,SPK_pub_B)&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;579.99&quot; y=&quot;210&quot; width=&quot;274.37&quot; height=&quot;130&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-5&quot; value=&quot;PQKEM.KeyGen()&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;identity key(IK_pub_A,&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;IK_prv_A&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;signed prekey(SPK_pub_A,SPK_prv_A)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Post-Quantum_Prekey(PQK_pub_A,PQK_prv_A)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;One-Time Prekey (OPK_A)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Sig(IK_prv_A,SPK_pub_A)&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-80&quot; y=&quot;210&quot; width=&quot;270&quot; height=&quot;110&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-6&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 24px;&amp;quot;&amp;gt;SIGNAL PROTOCOL&amp;lt;/font&amp;gt;&quot; style=&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;250&quot; y=&quot;-20&quot; width=&quot;280&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-11&quot; value=&quot;generate its key at registration&quot; style=&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;60&quot; y=&quot;140&quot; width=&quot;110&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-14&quot; value=&quot;generate its key at registration&quot; style=&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;720&quot; y=&quot;140&quot; width=&quot;110&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-26&quot; value=&quot;&quot; style=&quot;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;330&quot; y=&quot;260&quot; width=&quot;140&quot; height=&quot;80&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-27&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;rounded=0;exitX=0.991;exitY=0.654;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0;entryDx=0;entryDy=52.5;entryPerimeter=0;&quot; parent=&quot;1&quot; source=&quot;NsGaYPzq55yLYkSI8ves-5&quot; target=&quot;NsGaYPzq55yLYkSI8ves-26&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;400&quot; y=&quot;270&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;450&quot; y=&quot;220&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-28&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;rounded=0;entryX=1;entryY=0;entryDx=0;entryDy=52.5;entryPerimeter=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;&quot; parent=&quot;1&quot; source=&quot;NsGaYPzq55yLYkSI8ves-4&quot; target=&quot;NsGaYPzq55yLYkSI8ves-26&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;400&quot; y=&quot;270&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;450&quot; y=&quot;220&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-29&quot; value=&quot;upload public key to server&quot; style=&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;360&quot; y=&quot;300&quot; width=&quot;90&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-32&quot; value=&quot;store private key to device&quot; style=&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-30&quot; y=&quot;320&quot; width=&quot;170&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-35&quot; value=&quot;Perform ECDH operations&amp;lt;div&amp;gt;DH1=ECDH(IK_prv_A,SPK_pub_B)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;DH2=ECDH(EK_prv_A,IK_pub_B)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;DH3=ECDH(&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;EK_prv_A,SPK_pub_B)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;DH4=ECDH(&amp;lt;span style=&amp;quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&amp;quot;&amp;gt;EK_prv_A,OPK_pub_B)(optional)&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-100&quot; y=&quot;580&quot; width=&quot;250&quot; height=&quot;120&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-36&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;&quot; parent=&quot;1&quot; source=&quot;NsGaYPzq55yLYkSI8ves-35&quot; edge=&quot;1&quot; target=&quot;NsGaYPzq55yLYkSI8ves-37&quot;&gt;&#10;          &lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;400&quot; y=&quot;740&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;20&quot; y=&quot;740&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-12&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;NsGaYPzq55yLYkSI8ves-37&quot; target=&quot;NsGaYPzq55yLYkSI8ves-39&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-37&quot; value=&quot;then using&amp;lt;div&amp;gt;PQKEM-ENC(&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;(PQK_pub_B)&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;amp;nbsp;=(CT_pq,SS_pq)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;output-&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;CT-cipher text which send to Bob,&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;SS_pq-post quantum shared secret (from kyber-Lattice based-encryption)&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-125&quot; y=&quot;740&quot; width=&quot;300&quot; height=&quot;100&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-13&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;NsGaYPzq55yLYkSI8ves-39&quot; target=&quot;NsGaYPzq55yLYkSI8ves-40&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-39&quot; value=&quot;combine all operation INPUT=DH1||DH2||DH3||SS_pq&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-70&quot; y=&quot;890&quot; width=&quot;190&quot; height=&quot;70&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-19&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;NsGaYPzq55yLYkSI8ves-40&quot; target=&quot;uTYOB9S0JiPlJuJtjNri-17&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-40&quot; value=&quot;Session_Key(SK)=KDF(INPUT)&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-60&quot; y=&quot;1040&quot; width=&quot;170&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-42&quot; value=&quot;if ECDH is broken by quantum computer then other kyber is still protect the session&amp;amp;nbsp;&quot; style=&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-285&quot; y=&quot;1100&quot; width=&quot;160&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-46&quot; value=&quot;IK_pub_A,SPK_pub_A,PQK_pub_A,Sig_A,&amp;lt;div&amp;gt;IK_pub_B,SPK_pub_B,PQK_pub_B,Sig_B&amp;lt;/div&amp;gt;&quot; style=&quot;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;300&quot; y=&quot;380&quot; width=&quot;240&quot; height=&quot;120&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-47&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;&quot; parent=&quot;1&quot; source=&quot;NsGaYPzq55yLYkSI8ves-46&quot; target=&quot;NsGaYPzq55yLYkSI8ves-48&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;400&quot; y=&quot;500&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;80&quot; y=&quot;510&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-48&quot; value=&quot;Fetches Bob&amp;#39;s keys&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-100&quot; y=&quot;410&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-49&quot; value=&quot;IK_pub_B,SPK_pub_B,PQK_pub_B,Sig_B&quot; style=&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;140&quot; y=&quot;410&quot; width=&quot;60&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-52&quot; value=&quot;IK_pub_A,EK_PUB_A,CT_pq,Encrypted message&quot; style=&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;190&quot; y=&quot;1660&quot; width=&quot;270&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-53&quot; value=&quot;Encrypted messsage&amp;amp;nbsp;&amp;lt;div&amp;gt;encrypt(&amp;quot;hii&amp;quot;,MK0_A)&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-35.94&quot; y=&quot;1670&quot; width=&quot;150&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-55&quot; value=&quot;&quot; style=&quot;endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;&quot; parent=&quot;1&quot; source=&quot;NsGaYPzq55yLYkSI8ves-53&quot; edge=&quot;1&quot; target=&quot;NsGaYPzq55yLYkSI8ves-56&quot;&gt;&#10;          &lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;400&quot; y=&quot;1200&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;540&quot; y=&quot;1700&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-38&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;NsGaYPzq55yLYkSI8ves-56&quot; target=&quot;NsGaYPzq55yLYkSI8ves-59&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-56&quot; value=&quot;Perform ECDH operations&amp;lt;div&amp;gt;DH1=ECDH(SPK_prv_A,IK_pub_B)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;DH2=ECDH(IK_prv_A,EK_pub_B)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;DH3=ECDH(SPK&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;_prv_A,EK_pub_B)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;DH4=ECDH(OPK&amp;lt;span style=&amp;quot;color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;&amp;quot;&amp;gt;_A,EK_pub_B)(optional)&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;572.81&quot; y=&quot;1650&quot; width=&quot;257.19&quot; height=&quot;100&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-39&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;NsGaYPzq55yLYkSI8ves-59&quot; target=&quot;NsGaYPzq55yLYkSI8ves-61&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-59&quot; value=&quot;&amp;lt;div&amp;gt;Calculate shared secret&amp;lt;/div&amp;gt;PQKEM-DEC(PQK_prv_B,CT_pq)=SS_pq&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;582.58&quot; y=&quot;1790&quot; width=&quot;237.65&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-40&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;NsGaYPzq55yLYkSI8ves-61&quot; target=&quot;NsGaYPzq55yLYkSI8ves-64&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-61&quot; value=&quot;combine all operation INPUT=DH1||DH2||DH3||SS_pq&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;614.26&quot; y=&quot;1890&quot; width=&quot;174.29&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-44&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;NsGaYPzq55yLYkSI8ves-64&quot; target=&quot;uTYOB9S0JiPlJuJtjNri-43&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-64&quot; value=&quot;Derive session key&amp;amp;nbsp;&amp;lt;div&amp;gt;SK=KDF(INPUT)&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;626.4&quot; y=&quot;1990&quot; width=&quot;150&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-72&quot; value=&quot;END&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;635.25&quot; y=&quot;2860&quot; width=&quot;99.5&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;NsGaYPzq55yLYkSI8ves-73&quot; value=&quot;2.DH ratchet (asymmetric) -POST COMPROMISE SECURITY&amp;lt;div&amp;gt;Run only&amp;amp;nbsp;when a new DH key(ephemeral key) is introduced&amp;amp;nbsp;&amp;lt;/div&amp;gt;&quot; style=&quot;text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-510&quot; y=&quot;2940&quot; width=&quot;370&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-5&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 14px;&amp;quot;&amp;gt;1. Registration&amp;lt;/font&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-150&quot; y=&quot;140&quot; width=&quot;110&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-7&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 14px;&amp;quot;&amp;gt;2. Session Initiation (Alice messages Bob)&amp;lt;/font&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-215&quot; y=&quot;360&quot; width=&quot;290&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-9&quot; value=&quot;a) Fetches Keys&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-165&quot; y=&quot;380&quot; width=&quot;110&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-10&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 12px;&amp;quot;&amp;gt;b) Generates Ephemeral Key(EK_pub_A,EK_prv_A)&amp;lt;/font&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-155&quot; y=&quot;500&quot; width=&quot;305&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-11&quot; value=&quot;c) Computes Shared Secrets&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-155&quot; y=&quot;520&quot; width=&quot;170&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-14&quot; value=&quot;Three ECDH Secrets:&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-135&quot; y=&quot;550&quot; width=&quot;150&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-15&quot; value=&quot;One Post-Quantum Secret&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-150&quot; y=&quot;710&quot; width=&quot;170&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-16&quot; value=&quot;Derives Session Key&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-110&quot; y=&quot;1010&quot; width=&quot;140&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-72&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;uTYOB9S0JiPlJuJtjNri-17&quot; target=&quot;uTYOB9S0JiPlJuJtjNri-22&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-17&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;root_key = SK&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; # initial root key from PQXDH&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;align=center;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-112.5&quot; y=&quot;1220&quot; width=&quot;275&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-18&quot; value=&quot;DHs to compute the first DH output (dh_out), which will update the root key.&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-431.25&quot; y=&quot;3110&quot; width=&quot;410&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-26&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;uTYOB9S0JiPlJuJtjNri-22&quot; target=&quot;uTYOB9S0JiPlJuJtjNri-25&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-22&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;KDF_root(SK)=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;root_key(RK0_A), send_ck(CK0_S_A), recv_ck(CK0_R_A)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-92.03&quot; y=&quot;1360&quot; width=&quot;234.06&quot; height=&quot;50&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-36&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;uTYOB9S0JiPlJuJtjNri-25&quot; target=&quot;NsGaYPzq55yLYkSI8ves-53&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-25&quot; value=&quot;&amp;lt;div&amp;gt;&amp;amp;nbsp; KDF_chain(CK0_S_A) =&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;msg_key(MK0_A), next_send_chain_key(CK_1_A)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;Encrypted message&amp;lt;/span&amp;gt;&amp;amp;nbsp;=Encrypt(msg_key(MK0_A), plaintext)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;delete(msg_key)&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-150&quot; y=&quot;1535&quot; width=&quot;350&quot; height=&quot;70&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-27&quot; value=&quot;Root Update→ updates the root key and derives new chain keys&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-275&quot; y=&quot;1360&quot; width=&quot;140&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-28&quot; value=&quot;a) Symmetric Key Ratchet- Per Message&amp;amp;nbsp;&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-295&quot; y=&quot;1440&quot; width=&quot;240&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-29&quot; value=&quot;This provides forward secrecy —&amp;#xa;once a message key is used, it’s destroyed.&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-300&quot; y=&quot;1620&quot; width=&quot;270&quot; height=&quot;50&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-34&quot; value=&quot;Chain KDF → derives per-message encryption keys&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-240&quot; y=&quot;1490&quot; width=&quot;115&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-35&quot; value=&quot;Signal uses HMAC-SHA256 inside KDF_root and KDF_chain.&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-360&quot; y=&quot;1300&quot; width=&quot;180&quot; height=&quot;50&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-47&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;uTYOB9S0JiPlJuJtjNri-43&quot; target=&quot;uTYOB9S0JiPlJuJtjNri-45&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-43&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;root_key = SK&amp;amp;nbsp;&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;align=center;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;651.67&quot; y=&quot;2090&quot; width=&quot;97.69&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-73&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;uTYOB9S0JiPlJuJtjNri-45&quot; target=&quot;uTYOB9S0JiPlJuJtjNri-49&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-45&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;KDF_root(SK)=&amp;lt;/span&amp;gt;root_key(RK0_B), send_ck(CK0_S_B), recv_ck(CK0_R_B)&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;530&quot; y=&quot;2210&quot; width=&quot;310&quot; height=&quot;70&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-58&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;uTYOB9S0JiPlJuJtjNri-49&quot; target=&quot;uTYOB9S0JiPlJuJtjNri-56&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-49&quot; value=&quot;&amp;lt;div&amp;gt;&amp;amp;nbsp; KDF_chain(CK_S_B) =&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;msg_key(MK0_B), next_send_chain_key(CK_1_B)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;Decrypted-message&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;=Decrypt(MK0_B,Encrpted message)&amp;lt;/span&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;delete(msg_key)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;510&quot; y=&quot;2380&quot; width=&quot;350&quot; height=&quot;70&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-51&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 14px;&amp;quot;&amp;gt;Double ratchet&amp;lt;/font&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;449.99&quot; y=&quot;2070&quot; width=&quot;130&quot; height=&quot;50&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-52&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 14px;&amp;quot;&amp;gt;a) Symmetric Key Ratchet- Per Message&amp;amp;nbsp;&amp;lt;/font&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;366.4&quot; y=&quot;2300&quot; width=&quot;260&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-54&quot; value=&quot;Generates Ephemeral Key(EK_pub_B,EK_prv_B)&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;561.41&quot; y=&quot;2150&quot; width=&quot;310&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-59&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;uTYOB9S0JiPlJuJtjNri-56&quot; target=&quot;uTYOB9S0JiPlJuJtjNri-57&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-56&quot; value=&quot;Once decrypted-plaintext saved in Signal’s local database(&amp;lt;code data-end=&amp;quot;2919&amp;quot; data-start=&amp;quot;2908&amp;quot;&amp;gt;signal.db&amp;lt;/code&amp;gt; on Android or &amp;lt;code data-end=&amp;quot;2949&amp;quot; data-start=&amp;quot;2934&amp;quot;&amp;gt;Signal.sqlite&amp;lt;/code&amp;gt; on iOS)&quot; style=&quot;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;579.99&quot; y=&quot;2530&quot; width=&quot;210.71&quot; height=&quot;80&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-74&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;uTYOB9S0JiPlJuJtjNri-57&quot; target=&quot;NsGaYPzq55yLYkSI8ves-72&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;UserObject label=&quot;&amp;#xa;The key that decrypts &amp;lt;code data-end=&amp;quot;1240&amp;quot; data-start=&amp;quot;1229&amp;quot;&amp;gt;signal.db&amp;lt;/code&amp;gt; is &amp;lt;strong data-end=&amp;quot;1278&amp;quot; data-start=&amp;quot;1244&amp;quot;&amp;gt;stored inside Android Keystore&amp;lt;/strong&amp;gt; (or iOS Secure Enclave)&amp;#xa;&amp;#xa;&quot; link=&quot;&amp;#xa;The key that decrypts &amp;lt;code data-end=&amp;quot;1240&amp;quot; data-start=&amp;quot;1229&amp;quot;&amp;gt;signal.db&amp;lt;/code&amp;gt; is &amp;lt;strong data-end=&amp;quot;1278&amp;quot; data-start=&amp;quot;1244&amp;quot;&amp;gt;stored inside Android Keystore&amp;lt;/strong&amp;gt; (or iOS Secure Enclave)&amp;#xa;&amp;#xa;&quot; id=&quot;uTYOB9S0JiPlJuJtjNri-57&quot;&gt;&#10;          &lt;mxCell style=&quot;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;            &lt;mxGeometry x=&quot;596.8&quot; y=&quot;2710&quot; width=&quot;176.4&quot; height=&quot;80&quot; as=&quot;geometry&quot; /&gt;&#10;          &lt;/mxCell&gt;&#10;        &lt;/UserObject&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-61&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;Phase 2: Double Ratchet Initialization&amp;lt;/font&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-335&quot; y=&quot;1160&quot; width=&quot;305&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-63&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 18px;&amp;quot;&amp;gt;Phase 1: PQXDH Handshake&amp;lt;/font&amp;gt;&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-310&quot; y=&quot;80&quot; width=&quot;250&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-68&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;uTYOB9S0JiPlJuJtjNri-64&quot; target=&quot;uTYOB9S0JiPlJuJtjNri-65&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-64&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;root_key = SK&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; # initial root key from PQXDH&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;DHs = my_DH_keypair&amp;amp;nbsp; &amp;amp;nbsp; # your current DH keypair (e.g. EK_prv_A)&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;DHr = their_DH_pub&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;# peer&amp;#39;s DH public key (e.g. SPK_pub_B)&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;send_chain_key = None&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;recv_chain_key = None&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;align=center;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-404.69&quot; y=&quot;3000&quot; width=&quot;368.75&quot; height=&quot;100&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-69&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;uTYOB9S0JiPlJuJtjNri-65&quot; target=&quot;uTYOB9S0JiPlJuJtjNri-67&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-65&quot; value=&quot;&amp;lt;span style=&amp;quot;text-align: left;&amp;quot;&amp;gt;DH_out = DH(DHs,DHr)&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;#&amp;lt;/span&amp;gt;DH_out = DH(EK_prv_A, SPK_pub_B)&amp;lt;br style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;amp;nbsp;KDF_root(root_key, DH_out) =&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;text-align: left;&amp;quot;&amp;gt;new_root_key(RK0_A), send_ck(CK_S_A), recv_ck&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;text-align: left;&amp;quot;&amp;gt;(CK_R_A)&amp;lt;/span&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;old_root_key&amp;amp;nbsp; = SK&amp;amp;nbsp; &amp;amp;nbsp;( when initiation the starting chain first time )&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-419.37&quot; y=&quot;3160&quot; width=&quot;398.12&quot; height=&quot;70&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-76&quot; value=&quot;&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;uTYOB9S0JiPlJuJtjNri-67&quot; target=&quot;uTYOB9S0JiPlJuJtjNri-75&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-67&quot; value=&quot;&amp;lt;div&amp;gt;&amp;amp;nbsp; KDF_chain(CK_S_A) =&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;msg_key(MK0_A), next_send_chain_key(CK_1_A)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;Encrypted message&amp;lt;/span&amp;gt;&amp;amp;nbsp;=Encrypt(msg_key(MK0_A), plaintext)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;delete(msg_key)&amp;lt;/div&amp;gt;&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-395.32&quot; y=&quot;3280&quot; width=&quot;350&quot; height=&quot;70&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-70&quot; value=&quot;There’s no “new DH_out” to add yet — the handshake already did that work&quot; style=&quot;text;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;120&quot; y=&quot;1120&quot; width=&quot;230&quot; height=&quot;10&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uTYOB9S0JiPlJuJtjNri-75&quot; value=&quot;next further steps are same&quot; style=&quot;rounded=1;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;-280.31&quot; y=&quot;3390&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;      &lt;/root&gt;&#10;    &lt;/mxGraphModel&gt;&#10;  &lt;/diagram&gt;&#10;&lt;/mxfile&gt;&#10;"><defs/><rect fill="#ffffff" width="100%" height="100%" x="0" y="0" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212));"/><g><g data-cell-id="0"><g data-cell-id="1"><g data-cell-id="NsGaYPzq55yLYkSI8ves-21"><g transform="translate(0.5,0.5)"><path d="M 565 120 L 565 223.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 565 228.88 L 561.5 221.88 L 565 223.63 L 568.5 221.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-1"><g transform="translate(0.5,0.5)"><rect x="505" y="60" width="120" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 90px; margin-left: 506px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">ALICE</div></div></div></foreignObject><text x="565" y="94" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">ALICE</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-25"><g transform="translate(0.5,0.5)"><path d="M 1227.18 120 L 1227.18 223.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1227.18 228.88 L 1223.68 221.88 L 1227.18 223.63 L 1230.68 221.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-2"><g transform="translate(0.5,0.5)"><rect x="1167.18" y="60" width="120" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 90px; margin-left: 1168px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">BOB</div></div></div></foreignObject><text x="1227" y="94" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">BOB</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-3"><g transform="translate(0.5,0.5)"><rect x="855" y="60" width="120" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 90px; margin-left: 856px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">SERVER</div></div></div></foreignObject><text x="915" y="94" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">SERVER</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-4"><g transform="translate(0.5,0.5)"><rect x="1089.99" y="230" width="274.37" height="130" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 272px; height: 1px; padding-top: 295px; margin-left: 1091px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">PQKEM.KeyGen()<div><br /><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">identity key(IK_pub_B,</span><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">IK_prv_B</span><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">)</span><div>signed prekey(SPK_pub_B,SPK_prv_B)</div><div>Post-Quantum_Prekey(PQK_pub_B,PQK_prv_B)</div><div>One-Time Prekey (OPK_B)</div><div>Sig(IK_pub_B,SPK_pub_B)</div></div></div></div></div></div></foreignObject><text x="1227" y="299" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">PQKEM.KeyGen()...</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-5"><g transform="translate(0.5,0.5)"><rect x="430" y="230" width="270" height="110" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 268px; height: 1px; padding-top: 285px; margin-left: 431px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">PQKEM.KeyGen()<div><br /><div>identity key(IK_pub_A,<span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">IK_prv_A</span><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">)</span></div><div>signed prekey(SPK_pub_A,SPK_prv_A)</div><div>Post-Quantum_Prekey(PQK_pub_A,PQK_prv_A)</div><div>One-Time Prekey (OPK_A)</div><div>Sig(IK_prv_A,SPK_pub_A)</div></div></div></div></div></foreignObject><text x="565" y="289" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">PQKEM.KeyGen()...</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-6"><g transform="translate(0.5,0.5)"><rect x="760" y="0" width="280" height="30" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 278px; height: 1px; padding-top: 15px; margin-left: 761px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 24px;">SIGNAL PROTOCOL</font></div></div></div></foreignObject><text x="900" y="19" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">SIGNAL PROTOCOL</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-11"><g transform="translate(0.5,0.5)"><rect x="570" y="160" width="110" height="30" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 175px; margin-left: 571px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">generate its key at registration</div></div></div></foreignObject><text x="625" y="179" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">generate its key a...</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-14"><g transform="translate(0.5,0.5)"><rect x="1230" y="160" width="110" height="30" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 175px; margin-left: 1231px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">generate its key at registration</div></div></div></foreignObject><text x="1285" y="179" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">generate its key a...</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-26"><g transform="translate(0.5,0.5)"><path d="M 840 295 C 840 286.72 871.34 280 910 280 C 928.57 280 946.37 281.58 959.5 284.39 C 972.63 287.21 980 291.02 980 295 L 980 345 C 980 353.28 948.66 360 910 360 C 871.34 360 840 353.28 840 345 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 980 295 C 980 303.28 948.66 310 910 310 C 871.34 310 840 303.28 840 295" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-27"><g transform="translate(0.5,0.5)"><path d="M 697.57 301.94 L 833.77 331.16" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 838.91 332.27 L 831.33 334.22 L 833.77 331.16 L 832.8 327.37 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-28"><g transform="translate(0.5,0.5)"><path d="M 1089.99 295 L 986.03 330.45" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 981.06 332.14 L 986.55 326.57 L 986.03 330.45 L 988.81 333.19 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-29"><g transform="translate(0.5,0.5)"><rect x="870" y="320" width="90" height="30" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 335px; margin-left: 871px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">upload public key to server</div></div></div></foreignObject><text x="915" y="339" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">upload public k...</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-32"><g transform="translate(0.5,0.5)"><rect x="480" y="340" width="170" height="30" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 168px; height: 1px; padding-top: 355px; margin-left: 481px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">store private key to device</div></div></div></foreignObject><text x="565" y="359" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">store private key to device</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-35"><g transform="translate(0.5,0.5)"><rect x="410" y="600" width="250" height="120" rx="18" ry="18" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 248px; height: 1px; padding-top: 660px; margin-left: 411px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Perform ECDH operations<div>DH1=ECDH(IK_prv_A,SPK_pub_B)</div><div>DH2=ECDH(EK_prv_A,IK_pub_B)</div><div>DH3=ECDH(<span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">EK_prv_A,SPK_pub_B)</span></div><div>DH4=ECDH(<span style="color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;">EK_prv_A,OPK_pub_B)(optional)</span><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"></span></div></div></div></div></foreignObject><text x="535" y="664" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Perform ECDH operations...</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-36"><g transform="translate(0.5,0.5)"><path d="M 535 720 L 535 753.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 535 758.88 L 531.5 751.88 L 535 753.63 L 538.5 751.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-12"><g transform="translate(0.5,0.5)"><path d="M 535 860 L 535 903.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 535 908.88 L 531.5 901.88 L 535 903.63 L 538.5 901.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-37"><g transform="translate(0.5,0.5)"><rect x="385" y="760" width="300" height="100" rx="15" ry="15" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 298px; height: 1px; padding-top: 810px; margin-left: 386px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">then using<div>PQKEM-ENC(<span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">(PQK_pub_B)</span><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"> =(CT_pq,SS_pq)</span></div><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">output-</span></div><div>CT-cipher text which send to Bob,</div><div>SS_pq-post quantum shared secret (from kyber-Lattice based-encryption)</div></div></div></div></foreignObject><text x="535" y="814" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">then using...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-13"><g transform="translate(0.5,0.5)"><path d="M 535 980 L 535 1053.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 535 1058.88 L 531.5 1051.88 L 535 1053.63 L 538.5 1051.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-39"><g transform="translate(0.5,0.5)"><rect x="440" y="910" width="190" height="70" rx="10.5" ry="10.5" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 188px; height: 1px; padding-top: 945px; margin-left: 441px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">combine all operation INPUT=DH1||DH2||DH3||SS_pq</div></div></div></foreignObject><text x="535" y="949" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">combine all operation INPUT=DH1...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-19"><g transform="translate(0.5,0.5)"><path d="M 535 1120 L 535 1233.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 535 1238.88 L 531.5 1231.88 L 535 1233.63 L 538.5 1231.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-40"><g transform="translate(0.5,0.5)"><rect x="450" y="1060" width="170" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 168px; height: 1px; padding-top: 1090px; margin-left: 451px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Session_Key(SK)=KDF(INPUT)</div></div></div></foreignObject><text x="535" y="1094" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Session_Key(SK)=KDF(INPUT)</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-42"><g transform="translate(0.5,0.5)"><rect x="225" y="1120" width="160" height="30" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 158px; height: 1px; padding-top: 1135px; margin-left: 226px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">if ECDH is broken by quantum computer then other kyber is still protect the session </div></div></div></foreignObject><text x="305" y="1139" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">if ECDH is broken by quant...</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-46"><g transform="translate(0.5,0.5)"><path d="M 810 415 C 810 406.72 863.73 400 930 400 C 961.83 400 992.35 401.58 1014.85 404.39 C 1037.36 407.21 1050 411.02 1050 415 L 1050 505 C 1050 513.28 996.27 520 930 520 C 863.73 520 810 513.28 810 505 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1050 415 C 1050 423.28 996.27 430 930 430 C 863.73 430 810 423.28 810 415" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 238px; height: 1px; padding-top: 473px; margin-left: 811px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">IK_pub_A,SPK_pub_A,PQK_pub_A,Sig_A,<div>IK_pub_B,SPK_pub_B,PQK_pub_B,Sig_B</div></div></div></div></foreignObject><text x="930" y="477" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">IK_pub_A,SPK_pub_A,PQK_pub_A,Sig_A,...</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-47"><g transform="translate(0.5,0.5)"><path d="M 810 460 L 536.37 460" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 531.12 460 L 538.12 456.5 L 536.37 460 L 538.12 463.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-48"><g transform="translate(0.5,0.5)"><rect x="410" y="430" width="120" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 460px; margin-left: 411px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Fetches Bob's keys</div></div></div></foreignObject><text x="470" y="464" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Fetches Bob's keys</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-49"><g transform="translate(0.5,0.5)"><rect x="650" y="430" width="60" height="30" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 445px; margin-left: 651px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">IK_pub_B,SPK_pub_B,PQK_pub_B,Sig_B</div></div></div></foreignObject><text x="680" y="449" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">IK_pub_B,S...</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-52"><g transform="translate(0.5,0.5)"><rect x="700" y="1680" width="270" height="30" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 268px; height: 1px; padding-top: 1695px; margin-left: 701px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">IK_pub_A,EK_PUB_A,CT_pq,Encrypted message</div></div></div></foreignObject><text x="835" y="1699" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">IK_pub_A,EK_PUB_A,CT_pq,Encrypted message</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-53"><g transform="translate(0.5,0.5)"><rect x="474.06" y="1690" width="150" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 1720px; margin-left: 475px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Encrypted messsage <div>encrypt("hii",MK0_A)</div></div></div></div></foreignObject><text x="549" y="1724" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Encrypted messsage...</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-55"><g transform="translate(0.5,0.5)"><path d="M 624.06 1720 L 1076.44 1720" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1081.69 1720 L 1074.69 1723.5 L 1076.44 1720 L 1074.69 1716.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-38"><g transform="translate(0.5,0.5)"><path d="M 1211.33 1770 L 1211.33 1790 L 1211.33 1803.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1211.33 1808.88 L 1207.83 1801.88 L 1211.33 1803.63 L 1214.83 1801.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-56"><g transform="translate(0.5,0.5)"><rect x="1082.81" y="1670" width="257.19" height="100" rx="15" ry="15" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 255px; height: 1px; padding-top: 1720px; margin-left: 1084px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Perform ECDH operations<div>DH1=ECDH(SPK_prv_A,IK_pub_B)</div><div>DH2=ECDH(IK_prv_A,EK_pub_B)</div><div>DH3=ECDH(SPK<span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">_prv_A,EK_pub_B)</span></div><div>DH4=ECDH(OPK<span style="color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); background-color: transparent;">_A,EK_pub_B)(optional)</span><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"></span></div></div></div></div></foreignObject><text x="1211" y="1724" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Perform ECDH operations...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-39"><g transform="translate(0.5,0.5)"><path d="M 1211.33 1870 L 1211.33 1890 L 1211.33 1903.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1211.33 1908.88 L 1207.83 1901.88 L 1211.33 1903.63 L 1214.83 1901.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-59"><g transform="translate(0.5,0.5)"><rect x="1092.58" y="1810" width="237.65" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 236px; height: 1px; padding-top: 1840px; margin-left: 1094px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>Calculate shared secret</div>PQKEM-DEC(PQK_prv_B,CT_pq)=SS_pq</div></div></div></foreignObject><text x="1211" y="1844" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Calculate shared secretPQKEM-DEC(PQK_pr...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-40"><g transform="translate(0.5,0.5)"><path d="M 1211.33 1970 L 1211.33 1990 L 1211.33 2003.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1211.33 2008.88 L 1207.83 2001.88 L 1211.33 2003.63 L 1214.83 2001.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-61"><g transform="translate(0.5,0.5)"><rect x="1124.26" y="1910" width="174.29" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 172px; height: 1px; padding-top: 1940px; margin-left: 1125px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">combine all operation INPUT=DH1||DH2||DH3||SS_pq</div></div></div></foreignObject><text x="1211" y="1944" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">combine all operation INPUT=D...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-44"><g transform="translate(0.5,0.5)"><path d="M 1211.33 2070 L 1211.33 2090 L 1210.88 2103.64" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1210.7 2108.88 L 1207.44 2101.77 L 1210.88 2103.64 L 1214.44 2102 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-64"><g transform="translate(0.5,0.5)"><rect x="1136.4" y="2010" width="150" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 2040px; margin-left: 1137px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Derive session key <div>SK=KDF(INPUT)</div></div></div></div></foreignObject><text x="1211" y="2044" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Derive session key...</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-72"><g transform="translate(0.5,0.5)"><rect x="1145.25" y="2880" width="99.5" height="40" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 2900px; margin-left: 1146px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">END</div></div></div></foreignObject><text x="1195" y="2904" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">END</text></switch></g></g></g><g data-cell-id="NsGaYPzq55yLYkSI8ves-73"><g transform="translate(0.5,0.5)"><rect x="0" y="2960" width="370" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 368px; height: 1px; padding-top: 2980px; margin-left: 1px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">2.DH ratchet (asymmetric) -POST COMPROMISE SECURITY<div>Run only when a new DH key(ephemeral key) is introduced </div></div></div></div></foreignObject><text x="185" y="2984" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">2.DH ratchet (asymmetric) -POST COMPROMISE SECURITY...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-5"><g transform="translate(0.5,0.5)"><rect x="360" y="160" width="110" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 108px; height: 1px; padding-top: 167px; margin-left: 362px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 14px;">1. Registration</font></div></div></div></foreignObject><text x="362" y="179" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">1. Registration</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-7"><g transform="translate(0.5,0.5)"><rect x="295" y="380" width="290" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 288px; height: 1px; padding-top: 387px; margin-left: 297px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 14px;">2. Session Initiation (Alice messages Bob)</font></div></div></div></foreignObject><text x="297" y="399" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">2. Session Initiation (Alice messages Bob)</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-9"><g transform="translate(0.5,0.5)"><rect x="345" y="400" width="110" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 108px; height: 1px; padding-top: 407px; margin-left: 347px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">a) Fetches Keys</div></div></div></foreignObject><text x="347" y="419" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">a) Fetches Keys</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-10"><g transform="translate(0.5,0.5)"><rect x="355" y="520" width="305" height="30" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 303px; height: 1px; padding-top: 527px; margin-left: 357px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 12px;">b) Generates Ephemeral Key(EK_pub_A,EK_prv_A)</font></div></div></div></foreignObject><text x="357" y="539" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">b) Generates Ephemeral Key(EK_pub_A,EK_prv_A)</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-11"><g transform="translate(0.5,0.5)"><rect x="355" y="540" width="170" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 168px; height: 1px; padding-top: 547px; margin-left: 357px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">c) Computes Shared Secrets</div></div></div></foreignObject><text x="357" y="559" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">c) Computes Shared Secrets</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-14"><g transform="translate(0.5,0.5)"><rect x="375" y="570" width="150" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 148px; height: 1px; padding-top: 577px; margin-left: 377px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Three ECDH Secrets:</div></div></div></foreignObject><text x="377" y="589" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">Three ECDH Secrets:</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-15"><g transform="translate(0.5,0.5)"><rect x="360" y="730" width="170" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 168px; height: 1px; padding-top: 737px; margin-left: 362px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">One Post-Quantum Secret</div></div></div></foreignObject><text x="362" y="749" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">One Post-Quantum Secret</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-16"><g transform="translate(0.5,0.5)"><rect x="400" y="1030" width="140" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 138px; height: 1px; padding-top: 1037px; margin-left: 402px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Derives Session Key</div></div></div></foreignObject><text x="402" y="1049" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">Derives Session Key</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-72"><g transform="translate(0.5,0.5)"><path d="M 535 1300 L 535 1340 L 535 1373.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 535 1378.88 L 531.5 1371.88 L 535 1373.63 L 538.5 1371.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-17"><g transform="translate(0.5,0.5)"><rect x="397.5" y="1240" width="275" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 273px; height: 1px; padding-top: 1270px; margin-left: 399px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;">root_key = SK          # initial root key from PQXDH</div><div style="text-align: left;"><br /></div></div></div></div></foreignObject><text x="535" y="1274" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">root_key = SK          # initial root key from...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-18"><g transform="translate(0.5,0.5)"><rect x="78.75" y="3130" width="410" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 408px; height: 1px; padding-top: 3137px; margin-left: 81px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">DHs to compute the first DH output (dh_out), which will update the root key.</div></div></div></foreignObject><text x="81" y="3149" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">DHs to compute the first DH output (dh_out), which will update the r...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-26"><g transform="translate(0.5,0.5)"><path d="M 535 1430 L 535 1492.67 L 535 1548.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 535 1553.88 L 531.5 1546.88 L 535 1548.63 L 538.5 1546.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-22"><g transform="translate(0.5,0.5)"><rect x="417.97" y="1380" width="234.06" height="50" rx="7.5" ry="7.5" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 232px; height: 1px; padding-top: 1405px; margin-left: 419px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><div style="text-align: left;"><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">KDF_root(SK)=</span><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">root_key(RK0_A), send_ck(CK0_S_A), recv_ck(CK0_R_A)</span></div></div></div></div></div></foreignObject><text x="535" y="1409" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">KDF_root(SK)=root_key(RK0_A), send_ck(C...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-36"><g transform="translate(0.5,0.5)"><path d="M 535 1625 L 535 1657.67 L 549 1657.67 L 549 1683.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 549 1688.88 L 545.5 1681.88 L 549 1683.63 L 552.5 1681.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-25"><g transform="translate(0.5,0.5)"><rect x="360" y="1555" width="350" height="70" rx="10.5" ry="10.5" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 348px; height: 1px; padding-top: 1590px; margin-left: 361px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>  KDF_chain(CK0_S_A) = <span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">msg_key(MK0_A), next_send_chain_key(CK_1_A)</span></div><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">Encrypted message</span> =Encrypt(msg_key(MK0_A), plaintext)</div><div>delete(msg_key)</div></div></div></div></foreignObject><text x="535" y="1594" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">KDF_chain(CK0_S_A) = msg_key(MK0_A), next_send_chain_key...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-27"><g transform="translate(0.5,0.5)"><rect x="235" y="1380" width="140" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 138px; height: 1px; padding-top: 1387px; margin-left: 237px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Root Update→ updates the root key and derives new chain keys</div></div></div></foreignObject><text x="237" y="1399" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">Root Update→ updates the...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-28"><g transform="translate(0.5,0.5)"><rect x="215" y="1460" width="240" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 238px; height: 1px; padding-top: 1467px; margin-left: 217px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">a) Symmetric Key Ratchet- Per Message </div></div></div></foreignObject><text x="217" y="1479" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">a) Symmetric Key Ratchet- Per Message </text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-29"><g transform="translate(0.5,0.5)"><rect x="210" y="1640" width="270" height="50" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 268px; height: 1px; padding-top: 1647px; margin-left: 212px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">This provides forward secrecy —<br />once a message key is used, it’s destroyed.</div></div></div></foreignObject><text x="212" y="1659" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">This provides forward secrecy —...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-34"><g transform="translate(0.5,0.5)"><rect x="270" y="1510" width="115" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 113px; height: 1px; padding-top: 1517px; margin-left: 272px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Chain KDF → derives per-message encryption keys</div></div></div></foreignObject><text x="272" y="1529" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">Chain KDF → derives...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-35"><g transform="translate(0.5,0.5)"><rect x="150" y="1320" width="180" height="50" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 178px; height: 1px; padding-top: 1327px; margin-left: 152px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Signal uses HMAC-SHA256 inside KDF_root and KDF_chain.</div></div></div></foreignObject><text x="152" y="1339" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">Signal uses HMAC-SHA256 inside...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-47"><g transform="translate(0.5,0.5)"><path d="M 1210.67 2140 L 1210.67 2185 L 1195 2185 L 1195 2223.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1195 2228.88 L 1191.5 2221.88 L 1195 2223.63 L 1198.5 2221.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-43"><g transform="translate(0.5,0.5)"><rect x="1161.67" y="2110" width="97.69" height="30" rx="4.5" ry="4.5" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 96px; height: 1px; padding-top: 2125px; margin-left: 1163px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><div>root_key = SK  </div></div></div></div></div></foreignObject><text x="1211" y="2129" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">root_key = SK  </text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-73"><g transform="translate(0.5,0.5)"><path d="M 1195 2300 L 1195 2393.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1195 2398.88 L 1191.5 2391.88 L 1195 2393.63 L 1198.5 2391.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-45"><g transform="translate(0.5,0.5)"><rect x="1040" y="2230" width="310" height="70" rx="10.5" ry="10.5" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 308px; height: 1px; padding-top: 2265px; margin-left: 1041px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">KDF_root(SK)=</span>root_key(RK0_B), send_ck(CK0_S_B), recv_ck(CK0_R_B)</div></div></div></div></foreignObject><text x="1195" y="2269" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">KDF_root(SK)=root_key(RK0_B), send_ck(CK0_S_B), rec...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-58"><g transform="translate(0.5,0.5)"><path d="M 1195 2470 L 1195 2510 L 1195.28 2543.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1195.32 2548.88 L 1191.77 2541.91 L 1195.28 2543.63 L 1198.77 2541.85 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-49"><g transform="translate(0.5,0.5)"><rect x="1020" y="2400" width="350" height="70" rx="10.5" ry="10.5" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 348px; height: 1px; padding-top: 2435px; margin-left: 1021px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>  KDF_chain(CK_S_B) = <span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">msg_key(MK0_B), next_send_chain_key(CK_1_B)</span></div>Decrypted-message<span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">=Decrypt(MK0_B,Encrpted message)</span><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">delete(msg_key)</span></div></div></div></div></foreignObject><text x="1195" y="2439" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">KDF_chain(CK_S_B) = msg_key(MK0_B), next_send_chain_key(...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-51"><g transform="translate(0.5,0.5)"><rect x="959.99" y="2090" width="130" height="50" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 128px; height: 1px; padding-top: 2097px; margin-left: 962px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 14px;">Double ratchet</font></div></div></div></foreignObject><text x="962" y="2109" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">Double ratchet</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-52"><g transform="translate(0.5,0.5)"><rect x="876.4" y="2320" width="260" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 258px; height: 1px; padding-top: 2327px; margin-left: 878px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 14px;">a) Symmetric Key Ratchet- Per Message </font></div></div></div></foreignObject><text x="878" y="2339" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">a) Symmetric Key Ratchet- Per Message </text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-54"><g transform="translate(0.5,0.5)"><rect x="1071.41" y="2170" width="310" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 308px; height: 1px; padding-top: 2177px; margin-left: 1073px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Generates Ephemeral Key(EK_pub_B,EK_prv_B)</div></div></div></foreignObject><text x="1073" y="2189" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">Generates Ephemeral Key(EK_pub_B,EK_prv_B)</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-59"><g transform="translate(0.5,0.5)"><path d="M 1195.33 2630 L 1195.33 2680 L 1195.04 2723.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1195.01 2728.88 L 1191.55 2721.86 L 1195.04 2723.63 L 1198.55 2721.91 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-56"><g transform="translate(0.5,0.5)"><path d="M 1089.99 2565 C 1089.99 2556.72 1137.16 2550 1195.34 2550 C 1223.29 2550 1250.08 2551.58 1269.84 2554.39 C 1289.6 2557.21 1300.7 2561.02 1300.7 2565 L 1300.7 2615 C 1300.7 2623.28 1253.53 2630 1195.34 2630 C 1137.16 2630 1089.99 2623.28 1089.99 2615 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1300.7 2565 C 1300.7 2573.28 1253.53 2580 1195.34 2580 C 1137.16 2580 1089.99 2573.28 1089.99 2565" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 209px; height: 1px; padding-top: 2600px; margin-left: 1091px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Once decrypted-plaintext saved in Signal’s local database(<code data-start="2908" data-end="2919">signal.db</code> on Android or <code data-start="2934" data-end="2949">Signal.sqlite</code> on iOS)</div></div></div></foreignObject><text x="1195" y="2604" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Once decrypted-plaintext saved in S...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-74"><g transform="translate(0.5,0.5)"><path d="M 1195 2810 L 1195 2845 L 1195 2873.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1195 2878.88 L 1191.5 2871.88 L 1195 2873.63 L 1198.5 2871.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-57"><a xlink:href="https://app.diagrams.net/&#10;The key that decrypts &lt;code data-end=&quot;1240&quot; data-start=&quot;1229&quot;&gt;signal.db&lt;/code&gt; is &lt;strong data-end=&quot;1278&quot; data-start=&quot;1244&quot;&gt;stored inside Android Keystore&lt;/strong&gt; (or iOS Secure Enclave)&#10;&#10;"><g transform="translate(0.5,0.5)"><path d="M 1106.8 2745 C 1106.8 2736.72 1146.29 2730 1195 2730 C 1218.39 2730 1240.83 2731.58 1257.37 2734.39 C 1273.91 2737.21 1283.2 2741.02 1283.2 2745 L 1283.2 2795 C 1283.2 2803.28 1243.71 2810 1195 2810 C 1146.29 2810 1106.8 2803.28 1106.8 2795 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1283.2 2745 C 1283.2 2753.28 1243.71 2760 1195 2760 C 1146.29 2760 1106.8 2753.28 1106.8 2745" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 174px; height: 1px; padding-top: 2780px; margin-left: 1108px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><br />The key that decrypts <code data-start="1229" data-end="1240">signal.db</code> is <strong data-start="1244" data-end="1278">stored inside Android Keystore</strong> (or iOS Secure Enclave)<div><br /></div><div><br /></div></div></div></div></foreignObject><text x="1195" y="2784" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">The key that decrypts signal....</text></switch></g></g></a></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-61"><g transform="translate(0.5,0.5)"><rect x="175" y="1180" width="305" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 303px; height: 1px; padding-top: 1187px; margin-left: 177px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px;">Phase 2: Double Ratchet Initialization</font></div></div></div></foreignObject><text x="177" y="1199" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">Phase 2: Double Ratchet Initialization</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-63"><g transform="translate(0.5,0.5)"><rect x="200" y="100" width="250" height="40" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 248px; height: 1px; padding-top: 107px; margin-left: 202px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px;">Phase 1: PQXDH Handshake</font></div></div></div></foreignObject><text x="202" y="119" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">Phase 1: PQXDH Handshake</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-68"><g transform="translate(0.5,0.5)"><path d="M 289.67 3120 L 289.67 3150 L 289.67 3173.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 289.67 3178.88 L 286.17 3171.88 L 289.67 3173.63 L 293.17 3171.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-64"><g transform="translate(0.5,0.5)"><rect x="105.31" y="3020" width="368.75" height="100" rx="15" ry="15" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 367px; height: 1px; padding-top: 3070px; margin-left: 106px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;">root_key = SK          # initial root key from PQXDH</div><div style="text-align: left;">DHs = my_DH_keypair    # your current DH keypair (e.g. EK_prv_A)</div><div style="text-align: left;">DHr = their_DH_pub     # peer's DH public key (e.g. SPK_pub_B)</div><div style="text-align: left;">send_chain_key = None</div><div style="text-align: left;">recv_chain_key = None</div></div></div></div></foreignObject><text x="290" y="3074" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">root_key = SK          # initial root key from PQXDH...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-69"><g transform="translate(0.5,0.5)"><path d="M 289.67 3250 L 289.67 3275 L 289.67 3293.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 289.67 3298.88 L 286.17 3291.88 L 289.67 3293.63 L 293.17 3291.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-65"><g transform="translate(0.5,0.5)"><rect x="90.63" y="3180" width="398.12" height="70" rx="10.5" ry="10.5" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 396px; height: 1px; padding-top: 3215px; margin-left: 92px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><span style="text-align: left;">DH_out = DH(DHs,DHr)     #</span>DH_out = DH(EK_prv_A, SPK_pub_B)<br style="text-align: left;" /><span style="text-align: left;"> KDF_root(root_key, DH_out) = </span><span style="text-align: left;">new_root_key(RK0_A), send_ck(CK_S_A), recv_ck</span><span style="text-align: left;">(CK_R_A)</span><div><div style=""><div>old_root_key  = SK   ( when initiation the starting chain first time )</div></div></div></div></div></div></foreignObject><text x="290" y="3219" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">DH_out = DH(DHs,DHr)     #DH_out = DH(EK_prv_A, SPK_pub_B)...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-76"><g transform="translate(0.5,0.5)"><path d="M 289.68 3370 L 289.68 3403.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 289.68 3408.88 L 286.18 3401.88 L 289.68 3403.63 L 293.18 3401.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-67"><g transform="translate(0.5,0.5)"><rect x="114.68" y="3300" width="350" height="70" rx="10.5" ry="10.5" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 348px; height: 1px; padding-top: 3335px; margin-left: 116px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>  KDF_chain(CK_S_A) = <span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">msg_key(MK0_A), next_send_chain_key(CK_1_A)</span></div><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">Encrypted message</span> =Encrypt(msg_key(MK0_A), plaintext)</div><div>delete(msg_key)</div></div></div></div></foreignObject><text x="290" y="3339" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">KDF_chain(CK_S_A) = msg_key(MK0_A), next_send_chain_key(...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-70"><g transform="translate(0.5,0.5)"><rect x="630" y="1140" width="230" height="10" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 228px; height: 1px; padding-top: 1147px; margin-left: 632px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">There’s no “new DH_out” to add yet — the handshake already did that work</div></div></div></foreignObject><text x="632" y="1159" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">There’s no “new DH_out” to add yet — the h...</text></switch></g></g></g><g data-cell-id="uTYOB9S0JiPlJuJtjNri-75"><g transform="translate(0.5,0.5)"><rect x="229.69" y="3410" width="120" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all" style="fill: light-dark(#ffffff, var(--ge-dark-color, #121212)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 3440px; margin-left: 231px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">next further steps are same</div></div></div></foreignObject><text x="290" y="3444" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">next further steps a...</text></switch></g></g></g></g></g></g></svg>